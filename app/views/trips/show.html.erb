<div data-controller="toggle" class="relative h-screen">
  <!-- Toggle en bas de la page -->
  <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 z-20 flex space-x-2 bg-gray-200 p-2 rounded-full">
    <button
      data-action="click->toggle#toggle"
      data-view="map"
      data-toggle-target="mapToggle"
      class="p-2 bg-gray-800 text-white rounded-full">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 2C8.134 2 5 5.134 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.866-3.134-7-7-7zm0 9.5c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z" />
      </svg>
    </button>
    <button
      data-action="click->toggle#toggle"
      data-view="agenda"
      data-toggle-target="agendaToggle"
      class="p-2 bg-white text-gray-800 rounded-full">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 3h18v2H3V3zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" />
      </svg>
    </button>
  </div>

  <!-- Vue actuelle avec la carte et le carrousel -->

  <div class="map absolute top-0 left-0 right-0 bottom-0 z-0 block h-full" data-toggle-target="mapView">
  <div id="map" class="w-full h-full"
    data-controller="map"
    data-map-api-key-value='<%= ENV["MAPBOX_API_KEY"] %>'
    data-map-markers-value='<%= raw @markers.to_json %>'>
  </div>

<div class="absolute bottom-16 left-0 right-0 z-10 overflow-y-auto">
  <div data-controller="carrousel">
    <div class="carousel carousel-center rounded-box space-x-4 p-4">
      <% @activities.each_with_index do |activity, index| %>
        <div
          class="carousel-item bg-white shadow-lg rounded-lg w-80 p-4 border border-gray-200 cursor-pointer hover:shadow-xl transition-shadow"
          data-action="click->carrousel#select"
          data-carousel-index-value="<%= index %>">

          <!-- Photo -->
          <% if activity.photos.first.key.present? %>
            <%= cl_image_tag activity.photos.first.key, class: "rounded-full size-20" %>
          <% else %>
            <%= image_tag 'no_picture.jpg', class: "rounded-full size-20", alt: "No picture available" %>
          <% end %>

          <!-- Infos -->
          <div class="flex-col pl-4">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold text-gray-800"><%= activity.name %></h3>
            </div>
            <p class="text-xs text-gray-600"><%= activity.name %></p>
            <div class="flex items-center space-x-1 text-yellow-400">
              <% activity.reviews.to_i.times do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-3" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 .587l3.668 7.429L24 9.753l-6 5.837 1.417 8.26L12 18.897l-7.417 4.953L6 15.59l-6-5.837 8.332-1.737z" />
                </svg>
              <% end %>
            </div>
            <div class=" text-xs text-gray-500 flex items-center mt-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C8.134 2 5 5.134 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.866-3.134-7-7-7zm0 9.5c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z" />
              </svg>
              <%= activity.address %>
            </div>
          </div>

        </div>
      <% end %>
    </div>
  </div>
</div>
</div>
  <!-- Vue agenda -->

  <div data-toggle-target="agendaView" class="hidden h-full flex ">
<div class="w-full bg-black text-white" data-controller="tabs">
  <!-- Calendrier -->
  <div class="flex-col items-center justify-between px-4 py-3 bg-gray-900">
    <!-- Bouton retour -->
    <button class="btn btn-circle btn-outline border-gray-500 text-gray-400 mr-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>

    <!-- Jours dynamiques -->
    <div class="flex items-center overflow-x-scroll no-scrollbar space-x-20 mt-4" data-tabs-target="days">
      <% (@trip.start_date..@trip.end_date).each_with_index do |date, index| %>
        <div class="flex flex-col items-center cursor-pointer text-gray-400 <%= 'text-black bg-white rounded-lg px-2 py-1' if index == 0 %>"
             data-action="click->tabs#changeTab"
             data-tabs-day="<%= index %>"
             data-tabs-target="day">
          <span class="text-sm"><%= date.strftime('%a')[0].upcase %></span>
          <span class="text-xs font-bold"><%= date.strftime('%d') %></span>
        </div>
      <% end %>
    </div>

  </div>

  <!-- Tabs pour les jours -->
  <div role="tablist" class="tabs tabs-bordered bg-black text-white py-4 overflow-x-scroll ">
    <% (@trip.start_date..@trip.end_date).each_with_index do |_, index| %>
      <a class="tab <%= index == 0 ? 'tab-active text-white border-white w-36' : 'text-gray-400 w-36' %>"
         data-action="click->tabs#changeTab"
         data-tabs-day="<%= index %>"
         data-tabs-target="tab">Day <%= index + 1 %></a>
    <% end %>
  </div>

  <!-- Timeline Section -->
    <div class="p-4 hidden overflow-hidden" data-tabs-target="content" data-tabs-day="0">
      <ul class="relative">
        <li class="flex items-center space-x-4 relative mb-5" >
          <div class="text-gray-400 text-sm w-16  text-right">
            <div>10:00</div>
            <div>10:30</div>
          </div>
          <div class="relative flex flex-col items-center">
            <div class="w-4 h-4 bg-white rounded-full z-10"></div>
            <div class="absolute h-24 w-1 bg-white -top-20 left-1/2 transform -translate-x-1/2"></div>
          </div>
          <div class="bg-gray-800 text-white rounded-lg shadow-md p-4 w-full">
            <h3 class="font-bold">Chute de Montmorency</h3>
            <p class="text-sm">Magnifique cascade qui est la plus haute au monde.</p>
          </div>
        </li>
        <li class="flex items-center space-x-4 relative mb-5" >
          <div class="text-gray-400 text-sm w-16 text-right">
            <div>10:00</div>
            <div>10:30</div>
          </div>
          <div class="relative flex flex-col items-center">
            <div class="w-4 h-4 bg-white rounded-full z-10"></div>
            <div class="absolute h-24 w-1 bg-white -top-20 left-1/2 transform -translate-x-1/2"></div>
          </div>
          <div class="bg-gray-800 text-white rounded-lg shadow-md p-4 w-full">
            <h3 class="font-bold">Chute de Montmorency</h3>
            <p class="text-sm">Magnifique cascade qui est la plus haute au monde.</p>
          </div>
        </li>
        <li class="flex items-center space-x-4 relative mb-5" >
          <div class="text-gray-400 text-sm w-16  text-right">
            <div>10:00</div>
            <div>10:30</div>
          </div>
          <div class="relative flex flex-col items-center">
            <div class="w-4 h-4 bg-white rounded-full z-10"></div>
            <div class="absolute h-24 w-1 bg-white -top-20 left-1/2 transform -translate-x-1/2"></div>
          </div>
          <div class="bg-gray-800 text-white rounded-lg shadow-md p-4 w-full">
            <h3 class="font-bold">Chute de Montmorency</h3>
            <p class="text-sm">Magnifique cascade qui est la plus haute au monde.</p>
          </div>
        </li>
        <li class="flex items-center space-x-4 relative mb-5" >
          <div class="text-gray-400 text-sm w-16  text-right">
            <div>10:00</div>
            <div>10:30</div>
          </div>
          <div class="relative flex flex-col items-center">
            <div class="w-4 h-4 bg-white rounded-full z-10"></div>
            <div class="absolute h-24 w-1 bg-white -top-20 left-1/2 transform -translate-x-1/2"></div>
          </div>
          <div class="bg-gray-800 text-white rounded-lg shadow-md p-4 w-full">
            <h3 class="font-bold">Chute de Montmorency</h3>
            <p class="text-sm">Magnifique cascade qui est la plus haute au monde.</p>
          </div>
        </li>
      </ul>
    </div>
</div>
</div>
